<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Live garlinerd wallets balance</title>
	<style type="text/css"></style>
</head>
<body>
	<script src="./highstock/code/highstock.js"></script>
	<script src="./highstock/code/modules/exporting.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>

	<div id="container" style="height: 100%; min-width: 100%"></div>

	<script type="text/javascript">


		$.getJSON("./data/data.json", addData);

		function cumsum(array)
		{
			array.reduce(
				function(a, b, i)
				{
					return array[i] = a + b;
				}, 0
			)
			return array
		}

		function addData(data) 
		{
			$.getJSON("./series.json", function(wallets){	

				var stackedData = [];	

				for (wallet in wallets)
				{	

					var processedData =  $.map(data, function(el) 
						{ 
							if (wallets[wallet].indexOf(el.address) > -1)
							{
								return [el.value] 
							}
						});

					var timeData =  $.map(data, function(el) 
						{ 
							if (wallets[wallet].indexOf(el.address) > -1)
							{
								return [el.time * 1000] 
							}
						});

					processedData = cumsum(processedData);

					for (var i = 0; i < processedData.length; i++)
					{
						processedData[i] = [timeData[i], processedData[i]];
					}

					stackedData.push({
						name: wallet,
						data: processedData
					});

				}

				Highcharts.setOptions(
				{
					global: 
					{
						useUTC: false
					}
				});

				// Create the chart
				Highcharts.stockChart('container', 
				{
					chart: 
					{
						events: 
						{
							load: function () 
							{
				                // // some fancy random bullshit at the end
				                // var series = this.series[0];
				                // setInterval(function () 
				                // {
				                //     var x = (new Date()).getTime(), // current time
				                //     	y = Math.round(Math.random() * 100);
				                //     series.addPoint([x, y], true, true);
				                // }, 1000);
				            }
				        }
				    },

				    rangeSelector: 
				    {
				    	buttons: 
				    	[{
				    		count: 1,
				    		type: 'minute',
				    		text: '1M'
				    	}, 
				    	{
				    		count: 5,
				    		type: 'minute',
				    		text: '5M'
				    	}, 
				    	{
				    		type: 'all',
				    		text: 'All'
				    	}],
				    	inputEnabled: false,
				    	selected: 0
				    },

				    title: 
				    {
				    	text: 'Live garlinerd wallets balance'
				    },

				    exporting: 
				    {
				    	enabled: false
				    },

				    series: stackedData
				});
			});
		}

	</script>
</body>
</html>
